
=============================
Image Batch Bot — инструкция
=============================

Что вы получите:
- Мини-сервер, который по команде из вашего Custom GPT генерирует картинки в модели gpt-image-1-mini.
- Два режима: FAST (до 10 сразу) и BATCH (до 500 дешево, до 24ч).
- Картинки приходят уже горизонтальные: 16:9 (1920x1080) или 4:3 (1600x1200).

Шаг 1. Ключ OpenAI
------------------
1) Зайдите на platform.openai.com и создайте API Key.
2) Скопируйте его — он нужен на шаге запуска сервера.

Шаг 2. Запуск сервера на Render (самый простой)
-----------------------------------------------
1) Создайте бесплатный аккаунт на render.com.
2) Нажмите "New +" → "Web Service".
3) Укажите репозиторий (или выберите "Public Git repository" и позже загрузите файлы через "Manual Deploy"), но проще:
   - Нажмите "Skip repo" → "Create Blank" (если доступно) ИЛИ создайте новый репозиторий на GitHub и загрузите туда содержимое архива.
4) В разделе "Environment" поставьте Node 18+.
5) В "Build command" — `npm install`
6) В "Start command" — `npm start`
7) В переменные окружения добавьте:
   - `OPENAI_API_KEY` = ваш ключ
   - `ACTION_API_KEY` = придумайте любой длинный пароль (например, 32 символа)
8) Залейте файлы из архива (package.json, server.js).
9) Нажмите Deploy. Дождитесь статуса "Live". Скопируйте ваш URL вида https://имя.onrender.com

(Альтернатива: Replit. Создайте новый Repl → Node.js → загрузите файлы → в "Secrets" добавьте переменные → Run → скопируйте URL.)

Шаг 3. Подключение Actions в Custom GPT
---------------------------------------
1) Откройте chat.openai.com → "Explore" → "Create a GPT".
2) Введите название, например: "Image Batch Bot".
3) Вкладка "Actions" → "Add Action" → "Import from URL/Upload schema".
4) Скопируйте содержимое файла `openapi.yaml` и вставьте в редактор. Замените `https://YOUR_URL` на URL вашего сервера.
5) Сохраните. В "Authentication" выберите "API Key" и укажите имя заголовка `X-API-Key`, значение — ваш `ACTION_API_KEY`.
6) В "Instructions" добавьте правила:
   - Если промптов ≤ 10 — вызывать /submit-fast.
   - Если промптов > 10 — вызывать /submit-batch и возвращать batch_id. При просьбе "проверь статус" — вызывать /status.

Шаг 4. Как пользоваться
-----------------------
1) Откройте ваш GPT "Image Batch Bot".
2) Быстрый режим: напишите "Сделай 8 картинок 16:9 по промптам:" и дайте 8 строк. GPT вернёт картинки сразу.
3) Эконом-режим: напишите "Запусти пакет 300 промптов 4:3". GPT вернёт batch_id. Через время напишите "проверь статус batch_id=...". Когда будет готово — придут изображения.
4) Изображения приходят как data-URL (видно прямо в чате). Для производства лучше сохранять в облако — это можно добавить позже.

Где менять формат/качество
--------------------------
- В файле server.js функция toAspect делает кроп под 16:9 (1920x1080) или 4:3 (1600x1200).
- При желании можно вернуть квадрат (1024x1024) — для этого просто верните оригинал из toAspect.
- Качество управляется самой моделью: чем длиннее промпт и больше целевой размер, тем дороже. Для массовых партий используйте /submit-batch.

Безопасность
------------
- Никому не передавайте ваш OPENAI_API_KEY.
- X-API-Key защищает ваш сервер от внешних вызовов (его знает только ваш GPT Action).
